{% extends "base.html" %}

{% block title %}
  <title>Task Details</title>
{% endblock %}

{% block back_button %}
  <a href="{% url 'tasks:task-list' %}">
    <i class="fa fa-arrow-left"></i> Tasks List
  </a>
{% endblock %}

{% block actions %}
  <div class="d-flex">
    <form action="{% url 'tasks:task-toggle-completion' pk=task.pk %}" method="post" class="mr-3">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary">
        {{ task.is_completed|yesno:"Mark as Incomplete,Mark as Complete" }}
      </button>
    </form>
    <a href="{% url 'tasks:task-update' pk=task.pk %}" class="btn btn-secondary mr-3">
      Update
    </a>
    <a href="{% url 'tasks:task-delete' pk=task.pk %}" class="btn btn-danger">
      Delete
    </a>
  </div>
{% endblock %}

{% block content %}
  {% if messages %}
    <div class="alert alert-info" role="alert">
      {% for message in messages %}
        <p class="my-0">{{ message }}</p>
      {% endfor %}
    </div>
  {% endif %}
  <div class="d-flex justify-content-between align-items-center">
    <h1>{{ task.name }}</h1>
  </div>

  <small class="d-inline-block mb-2 mr-2">
    Priority:
    {% if task.priority %}
      <span class="text-{{ task.priority_class }}">
        <strong>{{ task.priority_label }}</strong>
      </span>
    {% endif %}
  </small>
  <small class="d-inline-block mb-2 mr-2">
    Is completed:
    <span class="text-{{ task.is_completed|yesno:'success,danger' }}">
      <strong>{{ task.is_completed|yesno:'Yes,No' }}</strong>
    </span>
  </small>
  <small class="d-inline-block mb-2">
    Created at:
    <strong>
      {{ task.created_at|date:"d F Y" }}
      <small class="text-muted">{{ task.created_at|time:"h:i A" }}</small>
    </strong>
  </small>

  <p class="mb-4">{{ task.description }}</p>

  <h2 class="h5">Deadline</h2>
  {% if task.deadline %}
    <p>{{ task.deadline|date:"d F Y" }} <small class="text-muted">{{ task.deadline|time:"h:i A" }}</small></p>
  {% else %}
    <p>No deadline</p>
  {% endif %}

  <h2 class="h5">Tags</h2>
  {% if task.tags %}
    <p class="mb-4">
      {% for tag in task.tags.all %}
        <span class="badge badge-primary badge-pill">{{ tag }}</span>
      {% empty %}
        No tags
      {% endfor %}
    </p>
  {% endif %}

  <h2 class="h5">Assigned to</h2>
  <div class="d-flex align-items-center pt-1">
    {% for assignee in task.assignees.all %}
      <a href="{% url "tasks:worker-detail" assignee.pk %}" class="mr-2">
        <img
            class="rounded-circle thumb-sm"
            alt="{{ assignee.username }}"
            src="https://avatar.iran.liara.run/username?username={{ assignee.first_name }}+{{ assignee.last_name }}"
            width="32"
            height="32"
        >
      </a>
    {% empty %}
      No assignees
    {% endfor %}
  </div>
{% endblock %}
